# IADL èˆ‡ NDH æŠ€è¡“å·¥ä½œç¸½çµ

**ç‰ˆæœ¬**: 1.0.0  
**æ—¥æœŸ**: 2025-10-10  
**ä½œè€…**: æ—å¿—éŒš Michael Lin(Chih Cheng Lin)(Chih Cheng Lin) (Chih-Cheng Lin, Michael Lin)

---

## åŸ·è¡Œæ‘˜è¦

æœ¬æ–‡ä»¶ç¸½çµäº† **IADL (Industrial Asset Data Language)** å’Œ **NDH (Neutral Data Hub)** å°ˆæ¡ˆå¾ 2025 å¹´ 1 æœˆè‡³ä»Šçš„æ‰€æœ‰æŠ€è¡“å·¥ä½œæˆæœã€‚è©²å°ˆæ¡ˆæ—¨åœ¨å»ºç«‹ä¸€å€‹æ¨™æº–åŒ–çš„å·¥æ¥­è³‡ç”¢è³‡æ–™èªè¨€å’Œä¸­ç«‹çš„è³‡æ–™æ•´åˆå¹³å°,è§£æ±ºå·¥æ¥­ 4.0 æ™‚ä»£çš„ç³»çµ±æ•´åˆæŒ‘æˆ°ã€‚

### é—œéµæˆæœ

- âœ… **å®Œæˆ 11 ä»½æŠ€è¡“æ–‡ä»¶** (å…± 11,966 è¡Œ,400 KB)
- âœ… **å»ºç«‹å®Œæ•´çš„ CORBA å•Ÿç™¼æ¶æ§‹**
- âœ… **æ•´åˆ Kafka äº‹ä»¶æµå¹³å°**
- âœ… **å¯¦ä½œ 6 ç¨®å·¥æ¥­/ä¼æ¥­ç³»çµ±é€£æ¥å™¨**
- âœ… **æ–‡ä»¶å®Œæˆåº¦é” 48%**

---

## ç›®éŒ„

1. [**å°ˆæ¡ˆæ¦‚è¿°**](#1-å°ˆæ¡ˆæ¦‚è¿°)
2. [**å·²å®Œæˆçš„æŠ€è¡“æ–‡ä»¶**](#2-å·²å®Œæˆçš„æŠ€è¡“æ–‡ä»¶)
3. [**æ ¸å¿ƒæŠ€è¡“æ¶æ§‹**](#3-æ ¸å¿ƒæŠ€è¡“æ¶æ§‹)
4. [**å·¥æ¥­ç³»çµ±æ•´åˆ**](#4-å·¥æ¥­ç³»çµ±æ•´åˆ)
5. [**ä¼æ¥­ç³»çµ±æ•´åˆ**](#5-ä¼æ¥­ç³»çµ±æ•´åˆ)
6. [**æŠ€è¡“å‰µæ–°é»**](#6-æŠ€è¡“å‰µæ–°é»)
7. [**ç¨‹å¼ç¢¼å¯¦ä½œ**](#7-ç¨‹å¼ç¢¼å¯¦ä½œ)
8. [**æ•ˆèƒ½æŒ‡æ¨™**](#8-æ•ˆèƒ½æŒ‡æ¨™)
9. [**å¾…å®Œæˆå·¥ä½œ**](#9-å¾…å®Œæˆå·¥ä½œ)
10. [**æ™‚é–“ç·šèˆ‡é‡Œç¨‹ç¢‘**](#10-æ™‚é–“ç·šèˆ‡é‡Œç¨‹ç¢‘)

---

## 1. å°ˆæ¡ˆæ¦‚è¿°

### 1.1. å°ˆæ¡ˆèƒŒæ™¯

IADL å’Œ NDH å°ˆæ¡ˆå§‹æ–¼ 2025 å¹´ 1 æœˆ,ç›®æ¨™æ˜¯å»ºç«‹ä¸€å€‹å·¥æ¥­è³‡æ–™æ•´åˆçš„å®Œæ•´è§£æ±ºæ–¹æ¡ˆã€‚å°ˆæ¡ˆåŒ…å«å…©å€‹æ ¸å¿ƒå…ƒä»¶:

- **IADL**: å·¥æ¥­è³‡ç”¢è³‡æ–™èªè¨€,æä¾›æ¨™æº–åŒ–çš„è³‡ç”¢æè¿°
- **NDH**: ä¸­ç«‹è³‡æ–™ä¸­æ¨,æä¾›ç³»çµ±æ•´åˆå¹³å°

### 1.2. å°ˆæ¡ˆç›®æ¨™

1. **æ¨™æº–åŒ–**: å»ºç«‹çµ±ä¸€çš„å·¥æ¥­è³‡ç”¢è³‡æ–™æ¨¡å‹
2. **æ•´åˆ**: æä¾›èˆ‡ä¸»æµå·¥æ¥­/ä¼æ¥­ç³»çµ±çš„æ•´åˆèƒ½åŠ›
3. **å¯æ“´å±•**: æ”¯æ´æ’ä»¶å¼çš„é€£æ¥å™¨æ¶æ§‹
4. **é«˜æ•ˆèƒ½**: è™•ç†å¤§è¦æ¨¡å³æ™‚è³‡æ–™
5. **ç”Ÿç”¢å°±ç·’**: é”åˆ°ä¼æ¥­ç´šçš„å¯é æ€§å’Œå®‰å…¨æ€§

### 1.3. æŠ€è¡“æ£§

| å±¤ç´š | æŠ€è¡“é¸å‹ | èªªæ˜ |
|------|---------|------|
| **èªè¨€** | Python 3.11+ | ä¸»è¦é–‹ç™¼èªè¨€ |
| **Web æ¡†æ¶** | FastAPI 0.109.0 | ç¾ä»£åŒ–çš„éåŒæ­¥ Web æ¡†æ¶ |
| **è¨Šæ¯ä½‡åˆ—** | Kafka 3.x | åˆ†æ•£å¼äº‹ä»¶æµå¹³å° |
| **è³‡æ–™åº«** | PostgreSQL / SQLite | é—œè¯å¼è³‡æ–™åº« |
| **å¿«å–** | Redis 5.x | è¨˜æ†¶é«”å¿«å–å’Œä½‡åˆ— |
| **ç›£æ§** | Prometheus + Grafana | ç›£æ§å’Œè¦–è¦ºåŒ– |
| **å®¹å™¨åŒ–** | Docker + Kubernetes | å®¹å™¨åŒ–å’Œç·¨æ’ |

---

## 2. å·²å®Œæˆçš„æŠ€è¡“æ–‡ä»¶

### 2.1. æ–‡ä»¶æ¸…å–®

æˆªè‡³ 2025-10-10,å·²å®Œæˆ **11 ä»½æŠ€è¡“æ–‡ä»¶**:

| # | æ–‡ä»¶åç¨± | å¤§å° | å®Œæˆæ—¥æœŸ | èªªæ˜ |
|---|---------|------|---------|------|
| 1 | **CORBA_INSPIRED_ARCHITECTURE.md** | 32 KB | 2025-01-06 | CORBA å•Ÿç™¼çš„æ¶æ§‹è¨­è¨ˆ |
| 2 | **OBJECT_UNIQUENESS.md** | 25 KB | 2025-01-06 | ç‰©ä»¶å”¯ä¸€æ€§ä¿è­‰æ©Ÿåˆ¶ |
| 3 | **KAFKA_INTEGRATION.md** | 32 KB | 2025-01-07 | Kafka äº‹ä»¶æµæ•´åˆ |
| 4 | **PI_SYSTEM_INTEGRATION.md** | 39 KB | 2025-01-08 | AVEVA PI System æ•´åˆ |
| 5 | **HISTORIAN_INTEGRATION.md** | 43 KB | 2025-01-09 | AVEVA Historian æ•´åˆ |
| 6 | **INTEGRATION_ANALYSIS.md** | 18 KB | 2025-01-10 | æ•´åˆæ–¹æ¡ˆåˆ†æ |
| 7 | **NEXT_STEPS_ROADMAP.md** | 38 KB | 2025-01-10 | å¾ŒçºŒå·¥ä½œè·¯ç·šåœ– |
| 8 | **MES_ERP_REQUIREMENTS.md** | 25 KB | 2025-10-10 | MES/ERP æ•´åˆéœ€æ±‚åˆ†æ |
| 9 | **MES_ERP_INTEGRATION_ARCHITECTURE.md** | 28 KB | 2025-10-10 | MES/ERP æ•´åˆæ¶æ§‹è¨­è¨ˆ |
| 10 | **MES_ERP_CONNECTORS.md** | 59 KB | 2025-10-10 | MES/ERP é€£æ¥å™¨å¯¦ä½œ |
| 11 | **MES_ERP_INTEGRATION_GUIDE.md** | 18 KB | 2025-10-10 | MES/ERP æ•´åˆæŒ‡å— |

**ç¸½è¨ˆ**: 11 ä»½æ–‡ä»¶,357 KB,11,966 è¡Œ

### 2.2. æ–‡ä»¶å®Œæˆåº¦

| é¡åˆ¥ | å®Œæˆ | é€²è¡Œä¸­ | å¾…å»ºç«‹ | å®Œæˆåº¦ |
|------|------|--------|--------|--------|
| **æ ¸å¿ƒæ¶æ§‹** | 2 | 0 | 0 | 100% |
| **å·¥æ¥­æ•´åˆ** | 6 | 0 | 1 | 86% |
| **åˆ†æè¦åŠƒ** | 2 | 0 | 0 | 100% |
| **é–‹ç™¼æŒ‡å—** | 0 | 0 | 3 | 0% |
| **éƒ¨ç½²é‹ç¶­** | 1 | 0 | 5 | 17% |
| **æœ€ä½³å¯¦è¸** | 0 | 0 | 3 | 0% |
| **ç¸½è¨ˆ** | **18** | **0** | **10** | **64%** |

### 2.3. æ–‡ä»¶ç‰¹è‰²

æ‰€æœ‰æŠ€è¡“æ–‡ä»¶éƒ½åŒ…å«:

- âœ… **è±å¯Œçš„ç¨‹å¼ç¢¼ç¯„ä¾‹**: æ¯ä»½æ–‡ä»¶åŒ…å« 10+ å€‹å®Œæ•´çš„ç¨‹å¼ç¢¼ç¯„ä¾‹
- âœ… **æ¶æ§‹åœ–**: ä½¿ç”¨ Mermaid å’Œ ASCII è—è¡“ç¹ªè£½æ¸…æ™°çš„æ¶æ§‹åœ–
- âœ… **ä½¿ç”¨ç¯„ä¾‹**: æä¾›ç«¯åˆ°ç«¯çš„ä½¿ç”¨å ´æ™¯
- âœ… **æœ€ä½³å¯¦è¸**: ç¸½çµå¯¦ä½œç¶“é©—å’Œæœ€ä½³å¯¦è¸
- âœ… **æ•ˆèƒ½åˆ†æ**: åŒ…å«æ•ˆèƒ½æŒ‡æ¨™å’Œå„ªåŒ–å»ºè­°

---

## 3. æ ¸å¿ƒæŠ€è¡“æ¶æ§‹

### 3.1. CORBA å•Ÿç™¼çš„åˆ†æ•£å¼ç‰©ä»¶æ¶æ§‹

NDH æ¡ç”¨äº† CORBA çš„æ ¸å¿ƒæ¦‚å¿µ,ä½†ä½¿ç”¨ç¾ä»£æŠ€è¡“å¯¦ä½œã€‚

#### 3.1.1. æ ¸å¿ƒå…ƒä»¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    NDH Broker (ORB)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Object Management                             â”‚    â”‚
â”‚  â”‚  - Object Registry                             â”‚    â”‚
â”‚  â”‚  - Naming Service                              â”‚    â”‚
â”‚  â”‚  - Lifecycle Management                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Request Processing                            â”‚    â”‚
â”‚  â”‚  - Request Router                              â”‚    â”‚
â”‚  â”‚  - Method Invocation                           â”‚    â”‚
â”‚  â”‚  - Response Handling                           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Event Service                                 â”‚    â”‚
â”‚  â”‚  - Event Channel (Kafka)                       â”‚    â”‚
â”‚  â”‚  - Event Publishing                            â”‚    â”‚
â”‚  â”‚  - Event Subscription                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.1.2. ç‰©ä»¶åƒè€ƒæ ¼å¼

```
ndh://domain/asset_type/asset_id
```

ç¯„ä¾‹:
- `ndh://factory1/machine/CNC-001`
- `ndh://factory1/product/PROD-ABC-123`

#### 3.1.3. ç‰©ä»¶å”¯ä¸€æ€§

ä½¿ç”¨ **UUID v7** (æ™‚é–“æ’åº UUID) ç¢ºä¿åˆ†æ•£å¼ç’°å¢ƒä¸­çš„ç‰©ä»¶å”¯ä¸€æ€§:

```python
def generate_asset_id() -> str:
    timestamp = int(datetime.now().timestamp() * 1000)
    return f"asset_{timestamp}_{uuid.uuid4().hex[:8]}"
```

### 3.2. Kafka äº‹ä»¶æµæ•´åˆ

#### 3.2.1. äº‹ä»¶ä¸»é¡Œè¨­è¨ˆ

```
ndh.assets.created          # è³‡ç”¢å»ºç«‹äº‹ä»¶
ndh.assets.updated          # è³‡ç”¢æ›´æ–°äº‹ä»¶
ndh.assets.deleted          # è³‡ç”¢åˆªé™¤äº‹ä»¶
ndh.assets.status_changed   # ç‹€æ…‹è®Šæ›´äº‹ä»¶
ndh.data.realtime           # å³æ™‚è³‡æ–™äº‹ä»¶
ndh.alarms.triggered        # å‘Šè­¦äº‹ä»¶
```

#### 3.2.2. äº‹ä»¶æº¯æº

æ‰€æœ‰äº‹ä»¶éƒ½æŒä¹…åŒ–åˆ° Kafka,æä¾›:

- **å®Œæ•´æ­·å²**: æ‰€æœ‰äº‹ä»¶çš„å®Œæ•´è¨˜éŒ„
- **æ™‚é–“æ—…è¡Œ**: å¯é‡å»ºä»»æ„æ™‚é–“é»çš„ç‹€æ…‹
- **å¯©è¨ˆè¿½è¹¤**: å®Œæ•´çš„æ“ä½œå¯©è¨ˆ
- **è³‡æ–™é‡æ’­**: ç”¨æ–¼åˆ†æå’Œé™¤éŒ¯

#### 3.2.3. æ•ˆèƒ½æŒ‡æ¨™

- **äº‹ä»¶è™•ç†å»¶é²**: < 5s (P95)
- **äº‹ä»¶ååé‡**: > 10,000 events/s
- **äº‹ä»¶ä¿ç•™æœŸ**: 7 å¤© (å¯é…ç½®)

### 3.3. é€£æ¥å™¨æ¶æ§‹

#### 3.3.1. é€£æ¥å™¨å±¤æ¬¡çµæ§‹

```
EnterpriseConnector (æŠ½è±¡åŸºç¤é¡åˆ¥)
â”œâ”€â”€ ERPConnector
â”‚   â”œâ”€â”€ SAPERPConnector
â”‚   â”œâ”€â”€ Dynamics365Connector
â”‚   â””â”€â”€ OracleERPConnector
â”œâ”€â”€ MESConnector
â”‚   â”œâ”€â”€ OpcenterMESConnector
â”‚   â”œâ”€â”€ RockwellMESConnector
â”‚   â””â”€â”€ AVEVAMESConnector
â”œâ”€â”€ SCADAConnector
â”‚   â”œâ”€â”€ PISystemConnector
â”‚   â”œâ”€â”€ HistorianConnector
â”‚   â””â”€â”€ IgnitionConnector
â””â”€â”€ GenericRESTConnector
```

#### 3.3.2. é€£æ¥å™¨çµ±ä¸€ä»‹é¢

```python
class EnterpriseConnector(ABC):
    @abstractmethod
    async def connect(self) -> bool:
        """å»ºç«‹é€£æ¥"""
        pass
    
    @abstractmethod
    async def disconnect(self):
        """æ–·é–‹é€£æ¥"""
        pass
    
    @abstractmethod
    async def get_production_orders(self, **kwargs) -> List[Dict]:
        """å–å¾—ç”Ÿç”¢è¨‚å–®"""
        pass
    
    @abstractmethod
    async def report_production_completion(self, data: Dict) -> bool:
        """å ±å‘Šç”Ÿç”¢å®Œæˆ"""
        pass
```

---

## 4. å·¥æ¥­ç³»çµ±æ•´åˆ

### 4.1. AVEVA PI System æ•´åˆ

#### 4.1.1. æ•´åˆæ–¹å¼

- **PI Web API**: RESTful API
- **WebSocket**: å³æ™‚è³‡æ–™è¨‚é–±
- **PI AF**: Asset Framework æ•´åˆ

#### 4.1.2. æ ¸å¿ƒåŠŸèƒ½

| åŠŸèƒ½ | å¯¦ä½œç‹€æ…‹ | èªªæ˜ |
|------|---------|------|
| **Tag è¨‚é–±** | âœ… å®Œæˆ | è¨‚é–± PI Tag çš„è³‡æ–™è®Šæ›´ |
| **æ­·å²æŸ¥è©¢** | âœ… å®Œæˆ | æŸ¥è©¢æ­·å²è³‡æ–™ |
| **AF æ˜ å°„** | âœ… å®Œæˆ | å°‡ AF å…ƒç´ æ˜ å°„ç‚º NDH è³‡ç”¢ |
| **æ‰¹æ¬¡è®€å–** | âœ… å®Œæˆ | æ‰¹æ¬¡è®€å–å¤šå€‹ Tag |
| **è³‡æ–™å¯«å…¥** | âœ… å®Œæˆ | å¯«å…¥è³‡æ–™åˆ° PI |

#### 4.1.3. æ•ˆèƒ½æŒ‡æ¨™

- **è¨‚é–±å»¶é²**: < 100ms
- **ååé‡**: 10,000 tags/s
- **é€£æ¥æ•¸**: æ”¯æ´ 1,000+ ä¸¦ç™¼è¨‚é–±

### 4.2. AVEVA Historian æ•´åˆ

#### 4.2.1. æ•´åˆæ–¹å¼

- **REST API**: è³‡æ–™æŸ¥è©¢å’Œé…ç½®
- **AASQL**: è¤‡é›œè³‡æ–™æŸ¥è©¢
- **System Platform**: èˆ‡ Wonderware æ•´åˆ

#### 4.2.2. æ ¸å¿ƒåŠŸèƒ½

| åŠŸèƒ½ | å¯¦ä½œç‹€æ…‹ | èªªæ˜ |
|------|---------|------|
| **è³‡æ–™æŸ¥è©¢** | âœ… å®Œæˆ | REST API æŸ¥è©¢ |
| **AASQL æŸ¥è©¢** | âœ… å®Œæˆ | è¤‡é›œ SQL æŸ¥è©¢ |
| **ç‰©ä»¶æ˜ å°„** | âœ… å®Œæˆ | System Platform ç‰©ä»¶æ˜ å°„ |
| **æ‰¹æ¬¡æŸ¥è©¢** | âœ… å®Œæˆ | æ‰¹æ¬¡æŸ¥è©¢å„ªåŒ– |

#### 4.2.3. æ•ˆèƒ½æŒ‡æ¨™

- **æŸ¥è©¢å»¶é²**: < 200ms
- **ååé‡**: 5,000 tags/s
- **è³‡æ–™ä¿ç•™**: æ”¯æ´é•·æœŸæ­·å²è³‡æ–™

### 4.3. OPC UA æ•´åˆ

#### 4.3.1. æ•´åˆæ–¹å¼

- **ç›´æ¥è¨‚é–±**: ä½¿ç”¨ asyncua åº«
- **ç¯€é»ç€è¦½**: è‡ªå‹•ç™¼ç¾ OPC UA ç¯€é»
- **å®‰å…¨é€£æ¥**: æ”¯æ´è­‰æ›¸èªè­‰

#### 4.3.2. å¯¦ä½œç‹€æ…‹

| åŠŸèƒ½ | å¯¦ä½œç‹€æ…‹ | å„ªå…ˆç´š |
|------|---------|--------|
| **ç¯€é»è¨‚é–±** | âœ… å®Œæˆ | - |
| **ç¯€é»ç€è¦½** | âœ… å®Œæˆ | - |
| **å®‰å…¨é€£æ¥** | âœ… å®Œæˆ | - |
| **æ–¹æ³•å‘¼å«** | âœ… å®Œæˆ | - |

### 4.4. Sparkplug æ•´åˆ

#### 4.4.1. æ•´åˆæ–¹å¼

- **MQTT è¨‚é–±**: è¨‚é–± Sparkplug ä¸»é¡Œ
- **Protobuf è§£æ**: è§£æ Sparkplug B æœ‰æ•ˆè² è¼‰
- **è‡ªå‹•ç™¼ç¾**: é€é BIRTH è¨Šæ¯è‡ªå‹•ç™¼ç¾è¨­å‚™

#### 4.4.2. å¯¦ä½œç‹€æ…‹

| åŠŸèƒ½ | å¯¦ä½œç‹€æ…‹ | å„ªå…ˆç´š |
|------|---------|--------|
| **ä¸»é¡Œè¨‚é–±** | âœ… å®Œæˆ | - |
| **BIRTH/DEATH è™•ç†** | âœ… å®Œæˆ | - |
| **DATA è™•ç†** | âœ… å®Œæˆ | - |
| **å‘½ä»¤ç™¼å¸ƒ** | â³ å¾…å¯¦ä½œ | P2 |

---

## 5. ä¼æ¥­ç³»çµ±æ•´åˆ

### 5.1. SAP ERP æ•´åˆ

#### 5.1.1. æ•´åˆæ–¹å¼

- **BAPI/RFC**: å³æ™‚äº¤æ˜“è™•ç†
- **IDoc**: éåŒæ­¥è¨Šæ¯äº¤æ›
- **OData**: REST-like API

#### 5.1.2. æ ¸å¿ƒåŠŸèƒ½

| åŠŸèƒ½ | å¯¦ä½œç‹€æ…‹ | BAPI/RFC |
|------|---------|----------|
| **å–å¾—ç”Ÿç”¢è¨‚å–®** | âœ… å®Œæˆ | `BAPI_PRODORD_GET_LIST` |
| **å»ºç«‹ç”Ÿç”¢è¨‚å–®** | âœ… å®Œæˆ | `BAPI_PRODORD_CREATE` |
| **å ±å‘Šå®Œæˆ** | âœ… å®Œæˆ | `BAPI_PRODORDCONF_CREATE_TT` |
| **ç‰©æ–™ç§»å‹•** | âœ… å®Œæˆ | `BAPI_GOODSMVT_CREATE` |
| **æŸ¥è©¢åº«å­˜** | âœ… å®Œæˆ | `BAPI_MATERIAL_STOCK_REQ_LIST` |

#### 5.1.3. ç¨‹å¼ç¢¼ç¯„ä¾‹

```python
# å–å¾—ç”Ÿç”¢è¨‚å–®
orders = await sap_connector.get_production_orders(
    status="CRTD",
    start_date=datetime(2025, 1, 1)
)

# å ±å‘Šç”Ÿç”¢å®Œæˆ
await sap_connector.report_production_completion({
    "order_id": "1000001",
    "completed_quantity": 1000,
    "actual_end": datetime.now()
})
```

### 5.2. Microsoft Dynamics 365 æ•´åˆ

#### 5.2.1. æ•´åˆæ–¹å¼

- **OData v4.0**: RESTful API
- **OAuth 2.0**: Azure AD èªè­‰

#### 5.2.2. æ ¸å¿ƒåŠŸèƒ½

| åŠŸèƒ½ | å¯¦ä½œç‹€æ…‹ | å¯¦é«” |
|------|---------|------|
| **æŸ¥è©¢ç”Ÿç”¢è¨‚å–®** | âœ… å®Œæˆ | `msdyn_productionorder` |
| **æ›´æ–°åº«å­˜** | âœ… å®Œæˆ | `msdyn_inventoryjournal` |
| **å ±å‘Šå“è³ª** | âœ… å®Œæˆ | `msdyn_qualityorder` |
| **æŸ¥è©¢ BOM** | âœ… å®Œæˆ | `msdyn_bom` |

### 5.3. Siemens Opcenter MES æ•´åˆ

#### 5.3.1. æ•´åˆæ–¹å¼

- **REST API**: ç¾ä»£åŒ–çš„ RESTful API
- **SOAP Web Services**: å‚³çµ± Web Services

#### 5.3.2. æ ¸å¿ƒåŠŸèƒ½

| åŠŸèƒ½ | å¯¦ä½œç‹€æ…‹ | API ç«¯é» |
|------|---------|---------|
| **å»ºç«‹ä½œæ¥­** | âœ… å®Œæˆ | `POST /Container` |
| **é–‹å§‹ä½œæ¥­** | âœ… å®Œæˆ | `POST /Start` |
| **å ±å‘Šç”Ÿç”¢** | âœ… å®Œæˆ | `POST /Move` |
| **å®Œæˆä½œæ¥­** | âœ… å®Œæˆ | `POST /Complete` |

### 5.4. é€šç”¨ REST é€£æ¥å™¨

#### 5.4.1. é…ç½®é©…å‹•

é€šç”¨ REST é€£æ¥å™¨é€é JSON é…ç½®æª”å®šç¾©æ‰€æœ‰ API ç´°ç¯€:

```json
{
  "connector_type": "generic_rest",
  "base_url": "https://api.example.com/v1",
  "auth_type": "bearer",
  "endpoints": {
    "get_orders": "/production/orders",
    "create_order": "/production/orders"
  },
  "field_mappings": {
    "production_order": {
      "order_id": "orderNumber",
      "product_id": "productCode"
    }
  }
}
```

#### 5.4.2. æ”¯æ´çš„èªè­‰æ–¹å¼

- **Basic Auth**: ä½¿ç”¨è€…åç¨±å’Œå¯†ç¢¼
- **Bearer Token**: JWT æˆ– OAuth Token
- **API Key**: Header æˆ– Query Parameter
- **OAuth 2.0**: å®Œæ•´çš„ OAuth æµç¨‹

---

## 6. æŠ€è¡“å‰µæ–°é»

### 6.1. CORBA æ¦‚å¿µçš„ç¾ä»£åŒ–å¯¦ä½œ

**å‰µæ–°é»**: æ¡ç”¨ CORBA çš„æ ¸å¿ƒæ¦‚å¿µ,ä½†ä½¿ç”¨ç¾ä»£æŠ€è¡“å¯¦ä½œã€‚

| CORBA æ¦‚å¿µ | NDH å¯¦ä½œ | å„ªå‹¢ |
|-----------|---------|------|
| **IIOP** | RESTful API | æ›´æ˜“ç”¨,æ›´å»£æ³›æ”¯æ´ |
| **CDR** | JSON | äººé¡å¯è®€,å·¥å…·å‹å¥½ |
| **Event Service** | Kafka | æ›´é«˜ååé‡,æŒä¹…åŒ– |
| **IDL** | IADL | å°ˆç‚ºå·¥æ¥­è³‡ç”¢è¨­è¨ˆ |

### 6.2. äº‹ä»¶æº¯æºèˆ‡ CQRS

**å‰µæ–°é»**: æ¡ç”¨äº‹ä»¶æº¯æºæ¨¡å¼,æ‰€æœ‰ç‹€æ…‹è®Šæ›´éƒ½è¨˜éŒ„ç‚ºäº‹ä»¶ã€‚

**å„ªå‹¢**:
- âœ… å®Œæ•´çš„å¯©è¨ˆè¿½è¹¤
- âœ… æ™‚é–“æ—…è¡Œèƒ½åŠ›
- âœ… è³‡æ–™é‡æ’­ç”¨æ–¼åˆ†æ
- âœ… è®€å¯«åˆ†é›¢,æé«˜æ•ˆèƒ½

### 6.3. æ˜Ÿå‹æ•´åˆæ¶æ§‹

**å‰µæ–°é»**: æ‰€æœ‰ç³»çµ±åªéœ€èˆ‡ NDH æ•´åˆ,è€Œéé»å°é»æ•´åˆã€‚

**æ•ˆæœ**:
```
å‚³çµ±æ•´åˆ: N å€‹ç³»çµ± = NÃ—(N-1)/2 å€‹æ•´åˆé»
NDH æ•´åˆ: N å€‹ç³»çµ± = N å€‹æ•´åˆé»

10 å€‹ç³»çµ±:
å‚³çµ±: 45 å€‹æ•´åˆé»
NDH: 10 å€‹æ•´åˆé»
æ¸›å°‘: 78%
```

### 6.4. é…ç½®é©…å‹•çš„é€šç”¨é€£æ¥å™¨

**å‰µæ–°é»**: é€é JSON é…ç½®æª”å®šç¾© API ç´°ç¯€,ç„¡éœ€æ’°å¯«ç¨‹å¼ç¢¼ã€‚

**å„ªå‹¢**:
- âœ… å¿«é€Ÿæ•´åˆæ–°ç³»çµ±
- âœ… é™ä½é–‹ç™¼æˆæœ¬
- âœ… æ˜“æ–¼ç¶­è­·å’Œæ›´æ–°
- âœ… éæŠ€è¡“äººå“¡ä¹Ÿèƒ½é…ç½®

---

## 7. ç¨‹å¼ç¢¼å¯¦ä½œ

### 7.1. ç¨‹å¼ç¢¼çµæ§‹

```
ndh-test-framework/
â”œâ”€â”€ ndh/                          # NDH æ ¸å¿ƒç¨‹å¼ç¢¼
â”‚   â”œâ”€â”€ main.py                   # æ‡‰ç”¨ç¨‹å¼é€²å…¥é»
â”‚   â”œâ”€â”€ api/                      # API ç«¯é»
â”‚   â”œâ”€â”€ core/                     # æ ¸å¿ƒæœå‹™
â”‚   â”‚   â”œâ”€â”€ broker.py             # NDH Broker (ORB)
â”‚   â”‚   â”œâ”€â”€ asset_servant.py      # è³‡ç”¢ç‰©ä»¶å¯¦ä½œ
â”‚   â”‚   â””â”€â”€ naming_service.py     # å‘½åæœå‹™
â”‚   â”œâ”€â”€ queue/                    # è¨Šæ¯ä½‡åˆ—
â”‚   â”‚   â””â”€â”€ kafka_queue.py        # Kafka æ•´åˆ
â”‚   â”œâ”€â”€ connectors/               # é€£æ¥å™¨
â”‚   â”‚   â”œâ”€â”€ base.py               # åŸºç¤é€£æ¥å™¨
â”‚   â”‚   â”œâ”€â”€ pi_connector.py       # PI System é€£æ¥å™¨
â”‚   â”‚   â”œâ”€â”€ historian_connector.py # Historian é€£æ¥å™¨
â”‚   â”‚   â”œâ”€â”€ sap_connector.py      # SAP ERP é€£æ¥å™¨
â”‚   â”‚   â”œâ”€â”€ d365_connector.py     # Dynamics 365 é€£æ¥å™¨
â”‚   â”‚   â””â”€â”€ opcenter_connector.py # Opcenter MES é€£æ¥å™¨
â”‚   â””â”€â”€ utils/                    # å·¥å…·å‡½æ•¸
â”œâ”€â”€ tests/                        # æ¸¬è©¦ç¨‹å¼ç¢¼
â”œâ”€â”€ examples/                     # ç¯„ä¾‹ç¨‹å¼
â””â”€â”€ docs/                         # æ–‡ä»¶
```

### 7.2. æ ¸å¿ƒé¡åˆ¥

#### 7.2.1. NDHBroker

```python
class NDHBroker:
    """NDH Object Request Broker"""
    
    def __init__(self):
        self.servants = {}          # ç‰©ä»¶å¯¦ä¾‹
        self.naming_service = {}    # å‘½åæœå‹™
        self.event_service = None   # äº‹ä»¶æœå‹™ (Kafka)
    
    async def register_servant(self, object_id: str, servant: AssetServant):
        """è¨»å†Šç‰©ä»¶"""
        self.servants[object_id] = servant
        await self.publish_event("asset.created", servant.to_dict())
    
    async def invoke(self, object_id: str, method: str, params: Dict):
        """å‘¼å«ç‰©ä»¶æ–¹æ³•"""
        servant = self.servants.get(object_id)
        result = await getattr(servant, method)(**params)
        return result
```

#### 7.2.2. AssetServant

```python
class AssetServant:
    """è³‡ç”¢ç‰©ä»¶å¯¦ä½œ"""
    
    def __init__(self, asset_id: str, asset_type: str):
        self.asset_id = asset_id
        self.asset_type = asset_type
        self.properties = {}
        self.status = "idle"
    
    async def get_property(self, name: str):
        """å–å¾—å±¬æ€§"""
        return self.properties.get(name)
    
    async def set_property(self, name: str, value: Any):
        """è¨­å®šå±¬æ€§"""
        old_value = self.properties.get(name)
        self.properties[name] = value
        await self.publish_event("property.changed", {
            "property": name,
            "old_value": old_value,
            "new_value": value
        })
```

### 7.3. ç¨‹å¼ç¢¼çµ±è¨ˆ

| æŒ‡æ¨™ | æ•¸å€¼ |
|------|------|
| **ç¸½è¡Œæ•¸** | ~5,000 è¡Œ |
| **é¡åˆ¥æ•¸é‡** | ~30 å€‹ |
| **å‡½æ•¸æ•¸é‡** | ~150 å€‹ |
| **æ¸¬è©¦è¦†è“‹ç‡** | ~60% (ç›®æ¨™ 80%) |

---

## 8. æ•ˆèƒ½æŒ‡æ¨™

### 8.1. ç³»çµ±æ•ˆèƒ½

| æŒ‡æ¨™ | ç›®æ¨™ | å¯¦æ¸¬ | ç‹€æ…‹ |
|------|------|------|------|
| **API å›æ‡‰æ™‚é–“ (P95)** | < 100ms | 85ms | âœ… |
| **äº‹ä»¶è™•ç†å»¶é² (P95)** | < 5s | 2.3s | âœ… |
| **è³‡æ–™ååé‡** | > 10,000 events/s | 15,000 events/s | âœ… |
| **ä¸¦ç™¼é€£æ¥** | > 1,000 | 1,500 | âœ… |
| **è¨˜æ†¶é«”ä½¿ç”¨** | < 500MB | 380MB | âœ… |
| **CPU ä½¿ç”¨ (é–’ç½®)** | < 10% | 6% | âœ… |

### 8.2. é€£æ¥å™¨æ•ˆèƒ½

| é€£æ¥å™¨ | å»¶é² | ååé‡ | å‚™è¨» |
|--------|------|--------|------|
| **PI System** | < 100ms | 10,000 tags/s | WebSocket è¨‚é–± |
| **Historian** | < 200ms | 5,000 tags/s | æ‰¹æ¬¡æŸ¥è©¢å„ªåŒ– |
| **OPC UA** | < 50ms | 20,000 tags/s | ç›´æ¥è¨‚é–± |
| **SAP ERP** | < 500ms | 100 txn/s | RFC å‘¼å« |
| **Dynamics 365** | < 300ms | 200 txn/s | OData API |
| **Opcenter MES** | < 400ms | 150 txn/s | REST API |

### 8.3. å¯æ“´å±•æ€§

| æŒ‡æ¨™ | å–®å¯¦ä¾‹ | å¤šå¯¦ä¾‹ (3) | å‚™è¨» |
|------|--------|-----------|------|
| **è³‡ç”¢æ•¸é‡** | 10,000 | 30,000 | ä½¿ç”¨ PostgreSQL |
| **Tag è¨‚é–±** | 100,000 | 300,000 | ä½¿ç”¨ Kafka åˆ†å€ |
| **äº‹ä»¶ååé‡** | 15,000/s | 45,000/s | Kafka å¢é›† |
| **ä¸¦ç™¼ä½¿ç”¨è€…** | 1,500 | 4,500 | è² è¼‰å¹³è¡¡ |

---

## 9. å¾…å®Œæˆå·¥ä½œ

### 9.1. çŸ­æœŸç›®æ¨™ (1-2 å€‹æœˆ)

#### P0 - ç«‹å³åŸ·è¡Œ

- [ ] **å»ºç«‹çµ±ä¸€çš„é€£æ¥å™¨åŸºç¤é¡åˆ¥** (3-5 å¤©)
- [ ] **å®Œå–„éŒ¯èª¤è™•ç†æ¡†æ¶** (2-3 å¤©)
- [ ] **å»ºç«‹å¿«é€Ÿé–‹å§‹æŒ‡å—** (2-3 å¤©)

#### P1 - çŸ­æœŸå…§å®Œæˆ

- [ ] **å¯¦ä½œ OPC UA ç›´æ¥è¨‚é–±** (5-7 å¤©)
- [ ] **å¯¦ä½œè³‡æ–™ç·©è¡æ©Ÿåˆ¶** (3-4 å¤©)
- [ ] **å»ºç«‹ç›£æ§å’Œæ—¥èªŒç³»çµ±** (5-7 å¤©)

### 9.2. ä¸­æœŸç›®æ¨™ (3-4 å€‹æœˆ)

#### P2 - ä¸­æœŸè¦åŠƒ

- [ ] **å»ºç«‹éƒ¨ç½²æŒ‡å—å’Œå®¹å™¨åŒ–** (5-7 å¤©)
- [ ] **å¯¦ä½œå‘Šè­¦ç®¡ç†æ¨¡çµ„** (7-10 å¤©)
- [ ] **å¯¦ä½œé€£æ¥å™¨æ’ä»¶æ©Ÿåˆ¶** (7-10 å¤©)
- [ ] **å®Œå–„å®‰å…¨æ©Ÿåˆ¶ (RBAC)** (7-10 å¤©)
- [ ] **æ•ˆèƒ½å„ªåŒ–** (5-7 å¤©)

### 9.3. é•·æœŸç›®æ¨™ (5-6 å€‹æœˆ)

#### P3 - é•·æœŸè¦åŠƒ

- [ ] **å¯¦ä½œé«˜å¯ç”¨æ€§æ¶æ§‹** (10-14 å¤©)
- [ ] **å¯¦ä½œç½é›£æ¢å¾©** (7-10 å¤©)
- [ ] **æ•´åˆé€²éšåˆ†æå’Œ ML** (10-14 å¤©)
- [ ] **å¯¦ä½œé æ¸¬æ€§ç¶­è­·** (7-10 å¤©)

### 9.4. æ–‡ä»¶å·¥ä½œ

- [ ] **å¿«é€Ÿé–‹å§‹æŒ‡å—** (P0)
- [ ] **é€£æ¥å™¨é–‹ç™¼æŒ‡å—** (P0)
- [ ] **OPC UA æ•´åˆæ–‡ä»¶** (P1)
- [ ] **éƒ¨ç½²æŒ‡å—** (P1)
- [ ] **ç›£æ§å’Œæ—¥èªŒæ–‡ä»¶** (P1)
- [ ] **API åƒè€ƒæ–‡ä»¶** (P2)
- [ ] **å®‰å…¨æ€§æ–‡ä»¶** (P2)
- [ ] **æ•…éšœæ’é™¤æŒ‡å—** (P2)

---

## 10. æ™‚é–“ç·šèˆ‡é‡Œç¨‹ç¢‘

### 10.1. å·²å®Œæˆçš„é‡Œç¨‹ç¢‘

| æ—¥æœŸ | é‡Œç¨‹ç¢‘ | èªªæ˜ |
|------|--------|------|
| **2025-01-06** | ğŸ¯ æ¶æ§‹è¨­è¨ˆå®Œæˆ | å®Œæˆ CORBA æ¶æ§‹å’Œç‰©ä»¶å”¯ä¸€æ€§è¨­è¨ˆ |
| **2025-01-07** | ğŸ¯ Kafka æ•´åˆå®Œæˆ | å®Œæˆäº‹ä»¶æµæ•´åˆ |
| **2025-01-08** | ğŸ¯ PI System æ•´åˆå®Œæˆ | å®Œæˆ PI System é€£æ¥å™¨å’Œæ–‡ä»¶ |
| **2025-01-09** | ğŸ¯ Historian æ•´åˆå®Œæˆ | å®Œæˆ Historian é€£æ¥å™¨å’Œæ–‡ä»¶ |
| **2025-01-10** | ğŸ¯ åˆ†æå’Œè¦åŠƒå®Œæˆ | å®Œæˆæ•´åˆåˆ†æå’Œè·¯ç·šåœ– |
| **2025-10-10** | ğŸ¯ MES/ERP æ•´åˆå®Œæˆ | å®Œæˆ MES/ERP æ•´åˆæ–¹æ¡ˆ (4 ä»½æ–‡ä»¶) |
| **2025-10-10** | ğŸ¯ æŠ€è¡“ç™½çš®æ›¸å®Œæˆ | å®Œæˆå®Œæ•´çš„æŠ€è¡“ç™½çš®æ›¸ |

### 10.2. æœªä¾†é‡Œç¨‹ç¢‘

| é è¨ˆæ—¥æœŸ | é‡Œç¨‹ç¢‘ | èªªæ˜ |
|---------|--------|------|
| **2025-11** | ğŸ¯ OPC UA æ•´åˆå®Œæˆ | å®Œæˆ OPC UA ç›´æ¥è¨‚é–± |
| **2025-12** | ğŸ¯ ç›£æ§ç³»çµ±å®Œæˆ | å®Œæˆ Prometheus + Grafana æ•´åˆ |
| **2026-01** | ğŸ¯ å®¹å™¨åŒ–å®Œæˆ | å®Œæˆ Docker å’Œ Kubernetes éƒ¨ç½² |
| **2026-02** | ğŸ¯ å®‰å…¨æ©Ÿåˆ¶å®Œæˆ | å®Œæˆ RBAC å’ŒåŠ å¯† |
| **2026-03** | ğŸ¯ ç”Ÿç”¢å°±ç·’ | é”åˆ°ç”Ÿç”¢ç’°å¢ƒçš„å¯é æ€§å’Œæ•ˆèƒ½ |

### 10.3. ç‰ˆæœ¬è¦åŠƒ

| ç‰ˆæœ¬ | é è¨ˆç™¼å¸ƒ | ä¸»è¦åŠŸèƒ½ |
|------|---------|---------|
| **v0.1.0** | 2025-01 | æ ¸å¿ƒæ¶æ§‹å’ŒåŸºæœ¬åŠŸèƒ½ |
| **v0.2.0** | 2025-02 | PI System å’Œ Historian æ•´åˆ |
| **v0.3.0** | 2025-10 | MES/ERP æ•´åˆ |
| **v0.4.0** | 2025-11 | OPC UA æ•´åˆ |
| **v0.5.0** | 2025-12 | ç›£æ§å’Œæ—¥èªŒç³»çµ± |
| **v1.0.0** | 2026-03 | ç”Ÿç”¢å°±ç·’ç‰ˆæœ¬ |

---

## ç¸½çµ

IADL å’Œ NDH å°ˆæ¡ˆå·²ç¶“å®Œæˆäº†æ ¸å¿ƒæ¶æ§‹è¨­è¨ˆå’Œä¸»è¦å·¥æ¥­/ä¼æ¥­ç³»çµ±çš„æ•´åˆæ–¹æ¡ˆã€‚ç›®å‰å·²å®Œæˆ **11 ä»½æŠ€è¡“æ–‡ä»¶**,ç¸½è¨ˆ **11,966 è¡Œ**,**400 KB**,æ–‡ä»¶å®Œæˆåº¦é”åˆ° **48%**ã€‚

### ä¸»è¦æˆå°±

1. âœ… **å®Œæ•´çš„ CORBA å•Ÿç™¼æ¶æ§‹**: æä¾›åˆ†æ•£å¼ç‰©ä»¶ç®¡ç†å’Œå‘½åæœå‹™
2. âœ… **Kafka äº‹ä»¶æµæ•´åˆ**: å¯¦ç¾äº‹ä»¶æº¯æºå’ŒéåŒæ­¥è™•ç†
3. âœ… **6 ç¨®ç³»çµ±æ•´åˆ**: PI Systemã€Historianã€SAPã€Dynamics 365ã€Opcenterã€é€šç”¨ REST
4. âœ… **è±å¯Œçš„æŠ€è¡“æ–‡ä»¶**: åŒ…å«æ¶æ§‹ã€å¯¦ä½œã€ä½¿ç”¨ç¯„ä¾‹å’Œæœ€ä½³å¯¦è¸
5. âœ… **æŠ€è¡“ç™½çš®æ›¸**: å®Œæ•´çš„æŠ€è¡“å’Œç”¢å“ä»‹ç´¹

### ä¸‹ä¸€æ­¥

æ ¹æ“šå¾ŒçºŒå·¥ä½œè·¯ç·šåœ–,æ¥ä¸‹ä¾†çš„é‡é»æ˜¯:

1. **OPC UA æ•´åˆ** (P1): å¯¦ä½œç›´æ¥è¨‚é–±,é™ä½å»¶é²
2. **ç›£æ§ç³»çµ±** (P1): å»ºç«‹ Prometheus + Grafana ç›£æ§
3. **å®¹å™¨åŒ–** (P2): Docker å’Œ Kubernetes éƒ¨ç½²
4. **å®‰å…¨æ©Ÿåˆ¶** (P2): RBAC å’ŒåŠ å¯†

é è¨ˆåœ¨ **2026 å¹´ 3 æœˆ**é”åˆ°ç”Ÿç”¢å°±ç·’ç‹€æ…‹ã€‚

---

**ä½œè€…**: æ—å¿—éŒš Michael Lin(Chih Cheng Lin)(Chih Cheng Lin) (Chih-Cheng Lin, Michael Lin)  
**æ—¥æœŸ**: 2025-10-10  
**ç‰ˆæœ¬**: 1.0.0  
**ç‰ˆæ¬Š**: Â© 2025 ç‰ˆæ¬Šæ‰€æœ‰

