# Asset Servant å„²å­˜è·è²¬æ¾„æ¸…

**ä½œè€…**: æ—å¿—éŒš Michael Lin(Chih Cheng Lin)(Chih Cheng Lin) Michael Lin(Chih Cheng Lin)  
**æ—¥æœŸ**: 2025å¹´10æœˆ14æ—¥  
**ç‰ˆæœ¬**: 1.0

---

## æ ¸å¿ƒåŸå‰‡

### Asset Servant ä¸å„²å­˜ä»»ä½•è³‡æ–™

**Asset Servant æ˜¯ä¸€å€‹ç„¡ç‹€æ…‹çš„æ˜ å°„æœå‹™,å®ƒä¸å„²å­˜:**
- âŒ USD 3D Model
- âŒ æ™‚åºæ•¸æ“š
- âŒ è³‡ç”¢å±¬æ€§
- âŒ æ–‡æª”æª”æ¡ˆ
- âŒ ä»»ä½•æŒä¹…åŒ–æ•¸æ“š

**Asset Servant åªå„²å­˜:**
- âœ… Tag æ˜ å°„è¡¨ (å¾ IADL è§£æè€Œä¾†,é‹è¡Œæ™‚è¨˜æ†¶é«”ä¸­)

---

## å®Œæ•´çš„è³‡æ–™å„²å­˜æ¶æ§‹

### 1. å„é¡è³‡æ–™çš„å¯¦éš›å„²å­˜ä½ç½®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    è³‡æ–™é¡å‹èˆ‡å„²å­˜ä½ç½®                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  ğŸ“„ IADL å®šç¾©æª”æ¡ˆ (è³‡ç”¢è—åœ–)                                 â”‚
â”‚     â”œâ”€ å„²å­˜ä½ç½®: Git Repository / æª”æ¡ˆç³»çµ±                   â”‚
â”‚     â””â”€ æ ¼å¼: YAML/JSON                                       â”‚
â”‚                                                              â”‚
â”‚  ğŸ¨ USD 3D Model (å¹¾ä½•æ¨¡å‹)                                  â”‚
â”‚     â”œâ”€ å„²å­˜ä½ç½®: Omniverse Nucleus / MinIO / S3             â”‚
â”‚     â””â”€ æ ¼å¼: .usd, .usda, .usdc                             â”‚
â”‚                                                              â”‚
â”‚  ğŸ“Š æ™‚åºæ•¸æ“š (Tag æ•¸æ“š)                                      â”‚
â”‚     â”œâ”€ å„²å­˜ä½ç½®: TDengine / PI System / InfluxDB           â”‚
â”‚     â””â”€ æ ¼å¼: æ™‚åºè³‡æ–™åº«åŸç”Ÿæ ¼å¼                              â”‚
â”‚                                                              â”‚
â”‚  ğŸ“‹ è³‡ç”¢å…ƒæ•¸æ“š (å±¬æ€§ã€é…ç½®)                                  â”‚
â”‚     â”œâ”€ å„²å­˜ä½ç½®: PostgreSQL (é—œä¿‚å‹è³‡æ–™åº«)                   â”‚
â”‚     â””â”€ æ ¼å¼: è¡¨æ ¼çµæ§‹                                        â”‚
â”‚                                                              â”‚
â”‚  ğŸ“ æ–‡æª”æª”æ¡ˆ (PDF, åœ–ç´™, ç…§ç‰‡)                               â”‚
â”‚     â”œâ”€ å„²å­˜ä½ç½®: MinIO / S3 / åˆ†æ•£å¼æª”æ¡ˆç³»çµ±                â”‚
â”‚     â””â”€ æ ¼å¼: åŸå§‹æª”æ¡ˆæ ¼å¼                                    â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Asset Servant åœ¨æ¶æ§‹ä¸­çš„ä½ç½®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ‡‰ç”¨å±¤                                  â”‚
â”‚  "çµ¦æˆ‘ PUMP-001 çš„ 3D æ¨¡å‹å’Œå£“åŠ›æ•¸æ“š"                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   NDH API å±¤                                 â”‚
â”‚  GET /api/v1/assets/PUMP-001                                â”‚
â”‚  GET /api/v1/assets/PUMP-001/model                          â”‚
â”‚  GET /api/v1/assets/PUMP-001/telemetry/discharge_pressure  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Asset Servant     â”‚  â”‚  å…¶ä»–æœå‹™                             â”‚
â”‚ (æ˜ å°„å±¤)          â”‚  â”‚  - Model Service (3D æ¨¡å‹æœå‹™)       â”‚
â”‚                   â”‚  â”‚  - Metadata Service (å…ƒæ•¸æ“šæœå‹™)     â”‚
â”‚ åªè² è²¬:           â”‚  â”‚  - Document Service (æ–‡æª”æœå‹™)       â”‚
â”‚ âœ… Tag æ˜ å°„       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ âœ… è·¯ç”±è«‹æ±‚       â”‚
â”‚                   â”‚
â”‚ ä¸å„²å­˜:           â”‚
â”‚ âŒ 3D Model       â”‚
â”‚ âŒ æ™‚åºæ•¸æ“š       â”‚
â”‚ âŒ ä»»ä½•æª”æ¡ˆ       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ™‚åºè³‡æ–™åº«æŠ½è±¡å±¤                                 â”‚
â”‚  query(measurement, start, end)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         å¯¦éš›å„²å­˜å±¤ (å„å¸å…¶è·)                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ TDengine â”‚ Omniverseâ”‚PostgreSQLâ”‚  MinIO   â”‚             â”‚
â”‚  â”‚ (æ™‚åº)   â”‚ (3Dæ¨¡å‹) â”‚ (å…ƒæ•¸æ“š) â”‚ (æª”æ¡ˆ)   â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## è©³ç´°èªªæ˜

### IADL å®šç¾© vs. Asset Servant å„²å­˜

**IADL æª”æ¡ˆå…§å®¹**:
```yaml
# pump001.iadl.yaml (å„²å­˜åœ¨ Git / æª”æ¡ˆç³»çµ±)

asset:
  asset_id: PUMP-001
  
  # 3D æ¨¡å‹å¼•ç”¨ (ä¸æ˜¯å¯¦éš›æ¨¡å‹,åªæ˜¯è·¯å¾‘)
  geometry:
    model_file: "omniverse://server/projects/plant1/models/pump001.usd"
    # â†‘ é€™åªæ˜¯ä¸€å€‹ URL å¼•ç”¨,å¯¦éš› USD æª”æ¡ˆåœ¨ Omniverse Nucleus
  
  # æ•¸æ“šæ¨™ç±¤å®šç¾©
  data_tags:
    - tag_id: discharge_pressure
      source:
        type: tdengine
        measurement: pump001_pressure
        # â†‘ é€™åªæ˜¯æ˜ å°„é…ç½®,å¯¦éš›æ•¸æ“šåœ¨ TDengine
  
  # éœæ…‹å±¬æ€§
  properties:
    manufacturer: "Grundfos"
    rated_power: 15
    # â†‘ é€™äº›å±¬æ€§æœƒè¢«è¼‰å…¥åˆ° PostgreSQL
  
  # æ–‡æª”å¼•ç”¨
  documents:
    - type: manual
      file_path: "s3://bucket/docs/pump001_manual.pdf"
      # â†‘ é€™åªæ˜¯ä¸€å€‹ S3 è·¯å¾‘,å¯¦éš› PDF åœ¨ MinIO/S3
```

**Asset Servant åœ¨è¨˜æ†¶é«”ä¸­çš„ç‹€æ…‹**:
```python
class AssetServant:
    def __init__(self, asset_id: str, iadl_definition: dict):
        self.asset_id = "PUMP-001"
        
        # åªå„²å­˜ Tag æ˜ å°„è¡¨ (é‹è¡Œæ™‚è¨˜æ†¶é«”)
        self.tag_mappings = {
            "discharge_pressure": {
                "db_type": "tdengine",
                "measurement": "pump001_pressure"
            }
        }
        
        # ä¸å„²å­˜ 3D æ¨¡å‹
        # ä¸å„²å­˜æ™‚åºæ•¸æ“š
        # ä¸å„²å­˜æ–‡æª”
        # ä¸å„²å­˜ä»»ä½•æª”æ¡ˆ
```

---

## å„é¡è³‡æ–™çš„è¨ªå•æµç¨‹

### å ´æ™¯ 1: ç²å– 3D æ¨¡å‹

```
æ‡‰ç”¨å±¤è«‹æ±‚:
  GET /api/v1/assets/PUMP-001/model

NDH API å±¤:
  â†“ (è·¯ç”±åˆ° Model Service,ä¸ç¶“é Asset Servant)
  
Model Service:
  1. æŸ¥è©¢ PostgreSQL ç²å–è³‡ç”¢å…ƒæ•¸æ“š
  2. å¾å…ƒæ•¸æ“šä¸­è®€å– model_file è·¯å¾‘
  3. å¾ Omniverse Nucleus ç²å– USD æª”æ¡ˆ
  4. è¿”å› USD æ¨¡å‹ URL æˆ–ä¸²æµ

Asset Servant: å®Œå…¨ä¸åƒèˆ‡æ­¤æµç¨‹ âŒ
```

### å ´æ™¯ 2: ç²å–æ™‚åºæ•¸æ“š

```
æ‡‰ç”¨å±¤è«‹æ±‚:
  GET /api/v1/assets/PUMP-001/telemetry/discharge_pressure

NDH API å±¤:
  â†“ (è·¯ç”±åˆ° Asset Servant)
  
Asset Servant:
  1. æŸ¥æ‰¾ Tag æ˜ å°„: "discharge_pressure" -> TDengine.pump001_pressure
  2. èª¿ç”¨ TSDB æŠ½è±¡å±¤
  â†“
  
TSDB æŠ½è±¡å±¤:
  â†“ (è·¯ç”±åˆ° TDengine Adapter)
  
TDengine:
  è¿”å›å¯¦éš›æ™‚åºæ•¸æ“š

Asset Servant: åªè² è²¬æ˜ å°„å’Œè·¯ç”± âœ…
Asset Servant: ä¸å„²å­˜æ™‚åºæ•¸æ“š âŒ
```

### å ´æ™¯ 3: ç²å–è³‡ç”¢å…ƒæ•¸æ“š

```
æ‡‰ç”¨å±¤è«‹æ±‚:
  GET /api/v1/assets/PUMP-001

NDH API å±¤:
  â†“ (è·¯ç”±åˆ° Metadata Service)
  
Metadata Service:
  1. æŸ¥è©¢ PostgreSQL
  2. è¿”å›è³‡ç”¢å±¬æ€§ (manufacturer, rated_power, etc.)

Asset Servant: å®Œå…¨ä¸åƒèˆ‡æ­¤æµç¨‹ âŒ
```

### å ´æ™¯ 4: ç²å–æ–‡æª”

```
æ‡‰ç”¨å±¤è«‹æ±‚:
  GET /api/v1/assets/PUMP-001/documents

NDH API å±¤:
  â†“ (è·¯ç”±åˆ° Document Service)
  
Document Service:
  1. æŸ¥è©¢ PostgreSQL ç²å–æ–‡æª”æ¸…å–®
  2. å¾ MinIO/S3 ç²å–å¯¦éš›æª”æ¡ˆ
  3. è¿”å›ä¸‹è¼‰ URL æˆ–ä¸²æµ

Asset Servant: å®Œå…¨ä¸åƒèˆ‡æ­¤æµç¨‹ âŒ
```

---

## NDH æœå‹™æ¶æ§‹ (å®Œæ•´ç‰ˆ)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   NDH å¾®æœå‹™æ¶æ§‹                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  ğŸ”§ Asset Servant Service                                   â”‚
â”‚     è·è²¬: Tag æ˜ å°„å’Œè·¯ç”±                                     â”‚
â”‚     å„²å­˜: ç„¡ (ç„¡ç‹€æ…‹æœå‹™)                                    â”‚
â”‚     ä¾è³´: IADL å®šç¾© (å¾æª”æ¡ˆç³»çµ±è®€å–)                         â”‚
â”‚                                                              â”‚
â”‚  ğŸ¨ Model Service                                           â”‚
â”‚     è·è²¬: 3D æ¨¡å‹ç®¡ç†                                        â”‚
â”‚     å„²å­˜: Omniverse Nucleus / MinIO                         â”‚
â”‚     åŠŸèƒ½: æ¨¡å‹ä¸Šå‚³ã€ä¸‹è¼‰ã€ç‰ˆæœ¬æ§åˆ¶                           â”‚
â”‚                                                              â”‚
â”‚  ğŸ“Š Telemetry Service                                       â”‚
â”‚     è·è²¬: æ™‚åºæ•¸æ“šæŸ¥è©¢                                       â”‚
â”‚     å„²å­˜: TDengine / PI / InfluxDB                          â”‚
â”‚     åŠŸèƒ½: æŸ¥è©¢ã€èšåˆã€è¨‚é–±                                   â”‚
â”‚                                                              â”‚
â”‚  ğŸ“‹ Metadata Service                                        â”‚
â”‚     è·è²¬: è³‡ç”¢å…ƒæ•¸æ“šç®¡ç†                                     â”‚
â”‚     å„²å­˜: PostgreSQL                                        â”‚
â”‚     åŠŸèƒ½: CRUD æ“ä½œã€æœç´¢ã€éæ¿¾                              â”‚
â”‚                                                              â”‚
â”‚  ğŸ“ Document Service                                        â”‚
â”‚     è·è²¬: æ–‡æª”ç®¡ç†                                           â”‚
â”‚     å„²å­˜: MinIO / S3                                        â”‚
â”‚     åŠŸèƒ½: ä¸Šå‚³ã€ä¸‹è¼‰ã€ç‰ˆæœ¬æ§åˆ¶                               â”‚
â”‚                                                              â”‚
â”‚  ğŸ”„ Sync Service                                            â”‚
â”‚     è·è²¬: æ•¸æ“šåŒæ­¥ (PI â†’ TDengine)                          â”‚
â”‚     å„²å­˜: ç„¡ (åªåšæ•¸æ“šæ¬é‹)                                  â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å®Œæ•´çš„è³‡æ–™æµç¯„ä¾‹

### æ‡‰ç”¨å ´æ™¯: Dashboard é¡¯ç¤ºè³‡ç”¢å®Œæ•´è³‡è¨Š

```javascript
// å‰ç«¯ Dashboard ä»£ç¢¼

// 1. ç²å–è³‡ç”¢åŸºæœ¬è³‡è¨Š (Metadata Service)
const assetInfo = await fetch('/api/v1/assets/PUMP-001');
// è¿”å›: { asset_id, manufacturer, rated_power, ... }

// 2. ç²å– 3D æ¨¡å‹ (Model Service)
const modelUrl = await fetch('/api/v1/assets/PUMP-001/model');
// è¿”å›: { model_url: "omniverse://server/.../pump001.usd" }

// 3. åœ¨ Omniverse ä¸­è¼‰å…¥æ¨¡å‹
omniverse.loadModel(modelUrl);

// 4. ç²å–å³æ™‚æ•¸æ“š (é€é Asset Servant)
const pressure = await fetch(
  '/api/v1/assets/PUMP-001/telemetry/discharge_pressure?latest=true'
);
// Asset Servant æ˜ å°„ -> TDengine æŸ¥è©¢ -> è¿”å›æ•¸æ“š

// 5. ç²å–æ–‡æª”æ¸…å–® (Document Service)
const docs = await fetch('/api/v1/assets/PUMP-001/documents');
// è¿”å›: [{ type: "manual", url: "s3://bucket/..." }, ...]
```

**æ•¸æ“šæµç¶“çš„æœå‹™**:
- æ­¥é©Ÿ 1: Metadata Service â†’ PostgreSQL
- æ­¥é©Ÿ 2: Model Service â†’ Omniverse Nucleus
- æ­¥é©Ÿ 3: å‰ç«¯ç›´æ¥é€£æ¥ Omniverse
- æ­¥é©Ÿ 4: Asset Servant (æ˜ å°„) â†’ Telemetry Service â†’ TDengine
- æ­¥é©Ÿ 5: Document Service â†’ MinIO/S3

**Asset Servant åªåƒèˆ‡æ­¥é©Ÿ 4**,ä¸”åªè² è²¬æ˜ å°„,ä¸å„²å­˜ä»»ä½•æ•¸æ“šã€‚

---

## ç‚ºä»€éº¼ Asset Servant ä¸å„²å­˜è³‡æ–™?

### è¨­è¨ˆåŸå‰‡: å–®ä¸€è·è²¬

**Asset Servant çš„å”¯ä¸€è·è²¬**:
> å°‡æŠ½è±¡çš„ã€èªç¾©åŒ–çš„ Tag ID æ˜ å°„åˆ°å¯¦éš›çš„ã€æŠ€è¡“æ€§çš„è³‡æ–™é»åç¨±

**å¦‚æœ Asset Servant å„²å­˜è³‡æ–™æœƒå°è‡´**:
1. âŒ è·è²¬ä¸æ¸…æ™° (æ—¢åšæ˜ å°„åˆåšå„²å­˜)
2. âŒ æ•¸æ“šå†—é¤˜ (3D æ¨¡å‹ã€æ™‚åºæ•¸æ“šéƒ½æœ‰å°ˆé–€çš„å„²å­˜ç³»çµ±)
3. âŒ æ“´å±•æ€§å·® (Asset Servant éœ€è¦è™•ç†å„ç¨®è³‡æ–™é¡å‹)
4. âŒ ç¶­è­·å›°é›£ (ä¸€å€‹æœå‹™æ‰¿æ“”å¤ªå¤šè²¬ä»»)

### è¨­è¨ˆåŸå‰‡: é—œæ³¨é»åˆ†é›¢

```
Asset Servant:  å°ˆæ³¨æ–¼ Tag æ˜ å°„å’Œè·¯ç”±
Model Service:  å°ˆæ³¨æ–¼ 3D æ¨¡å‹ç®¡ç†
Telemetry Service: å°ˆæ³¨æ–¼æ™‚åºæ•¸æ“šæŸ¥è©¢
Metadata Service: å°ˆæ³¨æ–¼å…ƒæ•¸æ“šç®¡ç†
Document Service: å°ˆæ³¨æ–¼æ–‡æª”ç®¡ç†
```

æ¯å€‹æœå‹™éƒ½æœ‰æ˜ç¢ºçš„è·è²¬é‚Šç•Œ,äº’ä¸å¹²æ“¾ã€‚

---

## Asset Servant çš„å®Œæ•´å®šç¾©

```python
class AssetServant:
    """
    è³‡ç”¢ Tag æ˜ å°„æœå‹™
    
    è·è²¬:
    - âœ… è§£æ IADL å®šç¾©,å»ºç«‹ Tag æ˜ å°„è¡¨
    - âœ… å°‡æŠ½è±¡ Tag ID æ˜ å°„åˆ°å¯¦éš›è³‡æ–™é»
    - âœ… è·¯ç”±æ™‚åºæ•¸æ“šæŸ¥è©¢åˆ°æ­£ç¢ºçš„è³‡æ–™åº«
    
    ä¸è² è²¬:
    - âŒ å„²å­˜ USD 3D Model
    - âŒ å„²å­˜æ™‚åºæ•¸æ“š
    - âŒ å„²å­˜è³‡ç”¢å…ƒæ•¸æ“š
    - âŒ å„²å­˜æ–‡æª”æª”æ¡ˆ
    - âŒ ç®¡ç†è³‡ç”¢ç”Ÿå‘½é€±æœŸ
    - âŒ åŸ·è¡Œæ¥­å‹™é‚è¼¯
    """
    
    def __init__(self, asset_id: str, iadl_path: str):
        """
        åˆå§‹åŒ– Asset Servant
        
        Args:
            asset_id: è³‡ç”¢ ID
            iadl_path: IADL å®šç¾©æª”æ¡ˆè·¯å¾‘ (å¾æª”æ¡ˆç³»çµ±è®€å–)
        """
        self.asset_id = asset_id
        
        # å¾æª”æ¡ˆç³»çµ±è®€å– IADL (ä¸å„²å­˜åœ¨ Asset Servant ä¸­)
        iadl_definition = self._load_iadl(iadl_path)
        
        # å»ºç«‹ Tag æ˜ å°„è¡¨ (é‹è¡Œæ™‚è¨˜æ†¶é«”,ä¸æŒä¹…åŒ–)
        self.tag_mappings = self._build_tag_mappings(iadl_definition)
    
    def _load_iadl(self, path: str) -> dict:
        """å¾æª”æ¡ˆç³»çµ±è¼‰å…¥ IADL å®šç¾©"""
        # IADL å„²å­˜åœ¨ Git / æª”æ¡ˆç³»çµ±,ä¸åœ¨ Asset Servant
        import yaml
        with open(path, 'r') as f:
            return yaml.safe_load(f)
    
    def _build_tag_mappings(self, iadl: dict) -> dict:
        """å»ºç«‹ Tag æ˜ å°„è¡¨ (åªåœ¨è¨˜æ†¶é«”ä¸­)"""
        mappings = {}
        for tag in iadl.get('data_tags', []):
            mappings[tag['tag_id']] = tag['source']
        return mappings
    
    async def get_tag_data(self, tag_id: str, start: datetime, end: datetime):
        """
        ç²å– Tag æ•¸æ“š (é€éæ˜ å°„å’Œè·¯ç”±)
        
        æµç¨‹:
        1. æŸ¥æ‰¾æ˜ å°„
        2. è·¯ç”±åˆ°æ­£ç¢ºçš„ TSDB
        3. è¿”å›æ•¸æ“š
        
        æ³¨æ„: ä¸å„²å­˜æ•¸æ“š,åªåšæŸ¥è©¢è·¯ç”±
        """
        mapping = self.tag_mappings[tag_id]
        
        # è·¯ç”±åˆ°æ­£ç¢ºçš„è³‡æ–™åº«
        if mapping['type'] == 'tdengine':
            return await self.tdengine_adapter.query(
                measurement=mapping['measurement'],
                start_time=start,
                end_time=end
            )
        elif mapping['type'] == 'pi_point':
            return await self.pi_adapter.query(
                measurement=mapping['point_name'],
                start_time=start,
                end_time=end
            )
```

---

## ç¸½çµ

### Asset Servant çš„å„²å­˜è·è²¬

**å„²å­˜ (é‹è¡Œæ™‚è¨˜æ†¶é«”)**:
- âœ… Tag æ˜ å°„è¡¨ (å¾ IADL è§£æè€Œä¾†)

**ä¸å„²å­˜ (ç”±å…¶ä»–æœå‹™è² è²¬)**:
- âŒ USD 3D Model â†’ Omniverse Nucleus / MinIO
- âŒ æ™‚åºæ•¸æ“š â†’ TDengine / PI System / InfluxDB
- âŒ è³‡ç”¢å…ƒæ•¸æ“š â†’ PostgreSQL
- âŒ æ–‡æª”æª”æ¡ˆ â†’ MinIO / S3
- âŒ IADL å®šç¾© â†’ Git / æª”æ¡ˆç³»çµ±

### æ ¸å¿ƒè¨­è¨ˆåŸå‰‡

1. **å–®ä¸€è·è²¬**: Asset Servant åªåš Tag æ˜ å°„å’Œè·¯ç”±
2. **ç„¡ç‹€æ…‹**: ä¸æŒä¹…åŒ–ä»»ä½•è³‡æ–™,å¯æ°´å¹³æ“´å±•
3. **é—œæ³¨é»åˆ†é›¢**: æ¯ç¨®è³‡æ–™é¡å‹ç”±å°ˆé–€çš„æœå‹™å’Œå„²å­˜ç³»çµ±ç®¡ç†
4. **æ¸…æ™°é‚Šç•Œ**: è·è²¬æ˜ç¢º,æ˜“æ–¼ç¶­è­·å’Œæ“´å±•

Asset Servant æ˜¯ä¸€å€‹**ç´”ç²¹çš„æ˜ å°„å’Œè·¯ç”±æœå‹™**,å®ƒä¸æ˜¯è³‡æ–™å„²å­˜å±¤,è€Œæ˜¯è³‡æ–™è¨ªå•çš„æŠ½è±¡å±¤ã€‚

