

# NDH-ERP 整合實施指南與最佳實踐

**作者**: 林志錚 Michael Lin(Chih Cheng Lin)(Chih Cheng Lin) Michael Lin(Chih Cheng Lin)  
**日期**: 2025年10月14日  
**版本**: 1.0

---

## 1. 簡介

本指南旨在為 NDH 與 ERP 的整合專案提供詳細的實施步驟和最佳實踐,以確保專案的順利進行和成功交付。

## 2. 實施步驟

### 階段一: 主數據同步 (1個月)

1. **開發 ERP Connector**: 使用 ERP 提供的 API (如 SAP BAPI) 開發一個服務,用於讀取設備主數據。
2. **擴展 IADL**: 在 IADL 模板中增加 `erp` 區塊,並為所有相關資產填寫 ERP 中的設備編號、成本中心等資訊。
3. **開發同步服務**: 開發一個定時任務,每天將 ERP 的設備主數據同步到 IADL 中。

### 階段二: 生產數據上傳 (NDH → ERP) (2-3個月)

1. **開發 KPI 計算引擎**: 在 NDH 中開發一個微服務,根據時序數據計算 OEE、MTBF、MTTR 等 KPI。
2. **開發生產確認服務**: 在 NDH 中開發一個微服務,根據 MES 的工單數據和 NDH 的時序數據,匯總產量、工時、物料消耗等數據。
3. **擴展 ERP Connector**: 增加將生產確認和 KPI 數據寫入 ERP 的功能 (如呼叫 SAP 的 BAPI_PRODORDCONF_CREATE_TT)。

### 階段三: 業務流程整合 (ERP → NDH) (2-3個月)

1. **擴展 ERP Connector**: 增加從 ERP 獲取生產工單的功能 (如讀取 SAP 的 IDoc)。
2. **擴展 Asset Tag Instance**: 讓 Asset Tag Instance 能夠接收生產工單,並將其與 MES 的工單進行關聯。

## 3. 最佳實踐

### 3.1 架構設計

- **優先使用非同步通訊**: 透過 Message Queue 實現系統解耦,避免 ERP 的性能問題影響到 NDH。
- **設計冪等的 API**: 確保重複呼叫 API 不會產生副作用,特別是在處理生產確認等關鍵業務時。
- **使用標準化的數據模型**: 嚴格遵守 ISA-95 標準,確保數據的一致性和可擴展性。

### 3.2 開發流程

- **採用敏捷開發**: 將專案分解為多個 Sprint,每個 Sprint 交付一部分功能,便於快速迭代和反饋。
- **編寫單元測試和整合測試**: 確保每個組件的品質和整合的穩定性。
- **使用版本控制**: 對 IADL、FDL 和程式碼進行版本控制,方便追蹤變更和協同開發。

### 3.3 部署與維護

- **使用容器化部署**: 將 ERP Connector、KPI 計算引擎等服務容器化 (Docker),方便部署和管理。
- **建立監控和告警機制**: 對整合層的各個組件進行監控,及時發現和處理問題。
- **制定數據備份和恢復計畫**: 確保關鍵數據的安全性。

---

